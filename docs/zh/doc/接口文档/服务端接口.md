# 服务端接口

## 管理端访问

### 服务管理

#### 创建服务

| 参数名     | 类型               | 描述                                             | 是否必填 |
| ---------- | ------------------ | ------------------------------------------------ | -------- |
| name       | string             | 服务名                                           | 是       |
| namespace  | string             | 命名空间                                         | 是       |
| metadata   | map<string,string> | 服务标签/元数据                                  | 否       |
| ports      | string             | 端口列表，多个port以逗号分隔                     | 否       |
| business   | string             | 服务所属业务，建议填写。                         | 否       |
| department | string             | 服务所属部门，建议填写。                         | 否       |
| comment    | string             | 描述                                             | 否       |
| owners     | string             | 负责人，**多个负责人以英文逗号或英文分号分隔。** | 是       |

请求示例：

```
POST /naming/v1/services
[
    {
        "name":"...",
        "namespace":"...",
        "metadata":{

        },
        "ports":"...",
        "business":"...",
        "department":"...",
        "comment":"...",
        "owners":"..."
    }
]
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "size":1,
    "responses":[
        {
            "code":200000,
            "info":"...",
            "service":{
                "name":"...",
                "namespace":"..."
            }
        }
    ]
}
```



#### 删除服务

删除一个不存在的服务，认为删除成功

| 参数名    | 类型   | 描述     | 是否必填 |
| --------- | ------ | -------- | -------- |
| name      | string | 服务名   | 是       |
| namespace | string | 命名空间 | 是       |

请求示例：

```
POST /naming/v1/services/delete
[
    {
        "name":"...",
        "namespace":"..."
    }
]
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "size":1,
    "responses":[
        {
            "code":200000,
            "info":"...",
            "service":{
                "name":"...",
                "namespace":"..."
            }
        }
    ]
}
```



#### 更新服务

| 参数名     | 类型               | 描述                                       | 是否必填 | 可否修改 |
| ---------- | ------------------ | ------------------------------------------ | -------- | -------- |
| name       | string             | 服务名                                     | 是       | 否       |
| namespace  | string             | 命名空间                                   | 是       | 否       |
| metadata   | map<string,string> | 服务标签/元数据                            | 否       | 是       |
| ports      | string             | 端口列表，多个port以逗号分隔               | 否       | 是       |
| business   | string             | 服务所属业务，建议填写。                   | 否       | 是       |
| department | string             | 服务所属部门，建议填写。                   | 否       | 是       |
| comment    | string             | 描述                                       | 否       | 是       |
| owners     | string             | 负责人，多个负责人以英文逗号或英文分号分隔 | 是       | 是       |

请求示例：

```
PUT /naming/v1/services
[
    {
        "name":"...",
        "namespace":"...",
        "token":"...",
        "metadata":{

        },
        "ports":"...",
        "business":"...",
        "department":"...",
        "comment":"...",
        "owners":"..."
    }
]
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "size":1,
    "responses":[
        {
            "code":200000,
            "info":"...",
            "service":{
                "name":"...",
                "namespace":"..."
            }
        }
    ]
}
```



#### 查询服务

GET /naming/v1/services?参数名=参数值

支持参数：

| 参数名     | 类型   | 描述                                                         | 是否必填 |
| ---------- | ------ | ------------------------------------------------------------ | -------- |
| name       | string | 服务名                                                       | 否       |
| namespace  | string | 命名空间                                                     | 否       |
| business   | string | 业务，默认模糊查询                                           | 否       |
| department | string | 部门                                                         | 否       |
| host       | string | 实例IP，**多个IP以英文逗号分隔**                             | 否       |
| port       | string | **实例端口**，**多个端口以英文逗号分隔**                     | 否       |
| keys       | string | 服务元数据名，keys和values需要同时填写，目前只支持查询一组元数据。 | 否       |
| values     | string | 服务元数据值，keys和values需要同时填写，目前只支持查询一组元数据。 | 否       |
| owner      | string | 负责人，目前只支持查询单个负责人，需输入完整英文名           | 否       |
| offset     | int    | 默认为0                                                      | 否       |
| limit      | int    | 默认为100，最大100                                           | 否       |

应答示例：

| 参数名 | 类型   | 描述                                                         |
| ------ | ------ | ------------------------------------------------------------ |
| code   | uint32 | 六位返回码                                                   |
| info   | string | 返回信息                                                     |
| amount | uint32 | 符合此查询条件的服务总数，例如查询命名空间为default的服务，总数为1000，本次返回100条，则amount为1000 |
| size   | uint32 | 本次查询返回的服务个数，例如查询命名空间为default的服务，总数为1000，本次返回100条，则size为100 |

```
{
    "code":200000,
    "info":"...",
    "amount":1,
    "size":1,
    "services":[
        {
            "name":"...",
            "namespace":"...",
            "metadata":{

            },
            "ports":"...",
            "business":"...",
            "department":"...",
            "comment":"...",
            "owners":"...",
            "ctime":"...",
            "mtime":"...",
            "total_instance_count": 1,
            "healthy_instance_count":1
        }
    ]
}
```





### 服务别名

#### 创建服务别名

| 参数名          | 类型   | 描述                   | 必填 |
| --------------- | ------ | ---------------------- | ---- |
| alias           | string | 服务别名               | 是   |
| alias_namespace | string | 服务别名所属命名空间   | 是   |
| service         | string | 指向的服务名           | 是   |
| namespace       | string | 指向的服务所属命名空间 | 是   |
| comment         | string | 服务别名描述           | 否   |
| owners          | string | 负责人，请填入polaris  | 是   |

请求示例：

```
POST /naming/v1/service/alias
{
    "service":"...",
    "namespace":"...",
    "alias":"...",
    "alias_namespace":"...",
    "owners":"...",
    "comment":"..."
}
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "alias":{
        "service":"...",
        "namespace":"...",
        "alias":"...",
        "alias_namespace":"...",
        "owners":"...",
        "comment":"..."
    }
}
```



#### 修改服务别名

| 参数名          | 类型   | 描述                   | 必填 |
| --------------- | ------ | ---------------------- | ---- |
| alias           | string | 服务别名               | 是   |
| alias_namespace | string | 服务别名所属命名空间   | 是   |
| service         | string | 指向的服务名           | 是   |
| namespace       | string | 指向的服务所属命名空间 | 是   |
| comment         | string | 服务别名描述           | 否   |
| owners          | string | 负责人，请填入polaris  | 是   |

请求示例：

```
PUT /naming/v1/service/alias
{
    "service":"...",
    "namespace":"...",
    "alias":"...",
    "alias_namespace":"...",
    "owners":"...",
    "comment":"..."
}
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "alias":{
        "service":"...",
        "namespace":"...",
        "alias":"...",
        "alias_namespace":"...",
        "owners":"...",
        "comment":"..."
    }
}
```



#### 删除服务别名

| 参数名          | 类型   | 描述                  | 必填 |
| --------------- | ------ | --------------------- | ---- |
| alias           | string | 服务别名              | 是   |
| alias_namespace | string | 服务别名所属命名空间  | 是   |
| owners          | string | 负责人，请填入polaris | 是   |

请求示例：

```
POST /naming/v1/service/alias/delete
[
    {
        "alias":"...",
        "alias_namespace":"...",
        "owners":"..."
    }
]
```

应答示例：

```
{
    "code":200000,
    "info":"...",
    "size":1,
    "responses":[
        {
            "code":200000,
            "info":"...",
            "alias":{
                "alias":"...",
                "alias_namespace":"..."
            }
        }
    ]
}
```



#### 查询服务别名

GET /naming/v1/service/aliases

支持参数：

| 参数名          | 类型   | 描述                         | 必填 |
| --------------- | ------ | ---------------------------- | ---- |
| alias           | string | 服务别名                     | 否   |
| alias_namespace | string | 服务别名所属命名空间         | 否   |
| service         | string | 指向的服务名                 | 否   |
| namespace       | string | 指向的服务所属命名空间       | 否   |
| offset          | int    | 分页偏移，默认0              | 否   |
| limit           | int    | 分页大小，默认为100，最大100 | 否   |

回复示例：

| 参数名 | 类型   | 描述                                                         |
| ------ | ------ | ------------------------------------------------------------ |
| size   | uint32 | 本次查询返回的服务别名个数，例如查询命名空间为Production的服务别名，总数为1000，本次返回100条，则size为100 |
| info   | string | 返回信息                                                     |
| code   | uint32 | 六位返回码                                                   |
| amount | uint32 | 符合此查询条件的服务别名总数，例如查询命名空间为Production的服务别名，总数为1000，本次返回100条，则amount为1000 |

```
{
    "code":200000,
    "info":"...",
    "amount":1,
    "size":1,
    "aliases":[
        {
            "alias":"...",
            "alias_namespace":"...",
            "namespace":"...",
            "service":"...",
            "owners":"...",
            "comment":"...",
            "ctime":"...",
            "mtime":"..."
        }
    ]
}
```



## 客户端访问